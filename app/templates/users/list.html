{% extends "layout/base.html" %}
{% block title %}Пользователи{% endblock %}

{% block extra_head %}
<script src="{{ url_for('static', filename='js/users.js') }}" defer></script>
{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">Пользователи</h1>

    <a href="{{ url_for('users.create') }}"
       class="px-4 py-2 rounded-full bg-green-600 text-white hover:bg-green-700">
        + Создать пользователя
    </a>
</div>

<div class="bg-white rounded-2xl shadow overflow-hidden">
    <table class="min-w-full text-sm">
        <thead class="bg-slate-800 text-white">
            <tr>
                <th class="px-3 py-2 text-left">ID</th>
                <th class="px-3 py-2 text-left">Логин</th>
                <th class="px-3 py-2 text-left">ФИО</th>
                <th class="px-3 py-2 text-left">Email</th>
                <th class="px-3 py-2 text-left">Отдел</th>
                <th class="px-3 py-2 text-left">Роль</th>
                <th class="px-3 py-2 text-left">Руководитель</th>
                <th class="px-3 py-2 text-center">Активен</th>
                <th class="px-3 py-2 text-right">Действия</th>
            </tr>
        </thead>

        <tbody class="divide-y divide-slate-200">

        {% for u in users %}
        <tr data-user-id="{{ u.id }}" class="hover:bg-slate-50">

            <td class="px-3 py-2">{{ u.id }}</td>

            <td class="px-3 py-2">
                <input type="text" class="inline-input w-full border px-2 py-1 rounded"
                       value="{{ u.username }}" data-field="username">
            </td>

            <td class="px-3 py-2">
                <input type="text" class="inline-input w-full border px-2 py-1 rounded"
                       value="{{ u.full_name }}" data-field="full_name">
            </td>

            <td class="px-3 py-2">
                <input type="email" class="inline-input w-full border px-2 py-1 rounded"
                       value="{{ u.email }}" data-field="email">
            </td>

            <td class="px-3 py-2">
                <select class="inline-input w-full border px-2 py-1 rounded"
                        data-field="department">
                    {% for d in DEPARTMENTS %}
                        <option value="{{ d }}" {% if u.department == d %}selected{% endif %}>{{ d }}</option>
                    {% endfor %}
                </select>
            </td>

            <td class="px-3 py-2">
                <select class="inline-input w-full border px-2 py-1 rounded"
                        data-field="role">
                    {% for r in ROLES %}
                        <option value="{{ r }}" {% if u.role == r %}selected{% endif %}>{{ r }}</option>
                    {% endfor %}
                </select>
            </td>

            <td class="px-3 py-2">
                <select class="inline-input w-full border px-2 py-1 rounded"
                        data-field="manager_id">
                    <option value="">—</option>
                    {% for m in managers %}
                        <option value="{{ m.id }}" {% if u.manager_id == m.id %}selected{% endif %}>
                            {{ m.full_name or m.username }}
                        </option>
                    {% endfor %}
                </select>
            </td>

            <td class="px-3 py-2 text-center">
                <input type="checkbox" class="inline-input-checkbox"
                       data-field="is_active_flag"
                       {% if u.is_active_flag %}checked{% endif %}>
            </td>

            <td class="px-3 py-2 text-right">
                <button class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700"
                        onclick="resetPassword({{ u.id }})">
                    Пароль
                </button>

                <button class="ml-2 px-3 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700"
                        onclick="deleteUser({{ u.id }})">
                    Удалить
                </button>
            </td>

        </tr>
        {% endfor %}

        </tbody>
    </table>
</div>

{% endblock %}
