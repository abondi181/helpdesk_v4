{% extends "layout/base.html" %}
{% block title %}Пользователи{% endblock %}

{% block content %}

<div class="bg-white rounded-2xl shadow p-4">
    <table class="min-w-full text-sm">
        <thead class="bg-slate-50 text-slate-600">
        <tr>
            <th class="px-3 py-2 text-left">ID</th>
            <th class="px-3 py-2 text-left">Email</th>
            <th class="px-3 py-2 text-left">ФИО</th>
            <th class="px-3 py-2 text-left">Роль</th>
            <th class="px-3 py-2 text-left">Отдел</th>
            <th class="px-3 py-2 text-left">Активен</th>
            <th class="px-3 py-2 text-right">Действия</th>
        </tr>
        </thead>

        <tbody class="divide-y divide-slate-100">

{% for u in users %}
<tr data-user-id="{{ u.id }}" class="hover:bg-slate-50">

    <td class="px-3 py-2">{{ u.id }}</td>

    <td class="px-3 py-2">{{ u.username }}</td>

    <td class="px-3 py-2">
        <input type="text"
               class="inline-input"
               data-field="full_name"
               value="{{ u.full_name or '' }}">
    </td>

    <td class="px-3 py-2">
        <select class="inline-input" data-field="role">
            {% for r in ROLES %}
            <option value="{{ r }}" {% if u.role == r %}selected{% endif %}>{{ r }}</option>
            {% endfor %}
        </select>
    </td>

    <td class="px-3 py-2">
        <input type="text"
               class="inline-input"
               data-field="department"
               value="{{ u.department or '' }}">
    </td>

    <td class="px-3 py-2 text-center">
        <input type="checkbox"
               class="inline-input-checkbox"
               data-field="is_active_flag"
               {% if u.is_active_flag %}checked{% endif %}>
    </td>

    <td class="px-3 py-2 text-right flex justify-end gap-3">

        <button class="text-blue-600 text-xs"
                onclick="openUserDrawer({{ u.id }})">
            Логи
        </button>

        <button class="text-orange-600 text-xs"
                onclick="resetPassword({{ u.id }})">
            Сбросить пароль
        </button>

    </td>

</tr>
{% endfor %}

</tbody>

    </table>
</div>
<!-- Drawer -->
<div id="userDrawer" class="fixed top-0 right-0 w-96 h-full bg-white shadow-xl transform translate-x-full transition-transform duration-300 z-50">
    
    <div class="p-4 border-b flex justify-between items-center">
        <h2 class="text-lg font-semibold">Логи пользователя</h2>
        <button onclick="closeUserDrawer()" class="text-slate-500 hover:text-black text-xl">&times;</button>
    </div>

    <div id="userDrawerContent" class="p-4 overflow-y-auto h-[calc(100%-60px)]">
        Загрузка...
    </div>
</div>

<script src="{{ url_for('static', filename='js/users.js') }}" defer></script>


{% endblock %}
